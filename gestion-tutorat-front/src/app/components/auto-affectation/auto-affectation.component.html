<!-- auto-affectation.component.html -->
<div class="container">
  <div class="equivalence-card">
    <span class="equivalence-icon"><i class="bi bi-arrow-left-right"></i></span>
    <label for="equivalence" class="equivalence-label">Équivalence :</label>
    <input type="number" id="equivalence" [(ngModel)]="equivalence" min="1" class="equivalence-input" />
    <span class="equivalence-help">Nombre de INI équivalents à 1 ALT (ex: 2 signifie 2 INI = 1 ALT)</span>
  </div>

  <h2>Résultat de l'affectation automatique</h2>
  <button (click)="loadAffectation()"><i class="bi bi-arrow-repeat"></i> Re/lancer l'affectation</button>

  <div *ngIf="loading">Chargement...</div>
  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

  <!-- Affichage du résumé sous forme de cartes -->
  <div *ngIf="result" class="summary-cards">
    <div class="summary-card">
      <span>Total étudiants traités</span><br>
      <span class="summary-value" style="color:#7b5fc9;">{{ result.total }}</span>
    </div>
    <div class="summary-card">
      <span>Étudiants affectés automatiquement</span><br>
      <span class="summary-value" style="color:#27ae60;">{{ result.assigned }}</span>
    </div>
    <div class="summary-card">
      <span>Étudiants à traiter manuellement</span><br>
      <span class="summary-value" style="color:#e67e22;">{{ result.total - result.assigned }}</span>
    </div>
  </div>

  <!-- Utilisation du composant table réutilisable -->
  <app-table [data]="pagedData" [columns]="columns" [showEdit]="false" [showDelete]="false"></app-table>

  <div class="pagination-controls" *ngIf="pageCount > 1">
    <button (click)="prevPage()" [disabled]="page === 1 || loading" class="pagination-btn">
      <i class="fas fa-chevron-left"></i> Précédent
    </button>
    <div class="pagination-numbers">
      <button *ngIf="page > 2" (click)="goToPage(1)" class="pagination-number">1</button>
      <span *ngIf="page > 3" class="pagination-ellipsis">...</span>
      <button *ngFor="let pageNum of visiblePages"
              (click)="goToPage(pageNum)"
              [class.active]="pageNum === page"
              class="pagination-number">
        {{ pageNum }}
      </button>
      <span *ngIf="page < pageCount - 2" class="pagination-ellipsis">...</span>
      <button *ngIf="page < pageCount - 1" (click)="goToPage(pageCount)" class="pagination-number">
        {{ pageCount }}
      </button>
    </div>
    <button (click)="nextPage()" [disabled]="page === pageCount || loading" class="pagination-btn">
      Suivant <i class="fas fa-chevron-right"></i>
    </button>
    <span *ngIf="loading" class="loading-indicator">Chargement...</span>
  </div>
</div>